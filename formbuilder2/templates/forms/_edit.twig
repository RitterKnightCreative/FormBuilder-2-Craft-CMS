{% extends "_layouts/cp" %}
{# Maybe delte bellow? #}
{% import "_includes/forms" as forms %}
{% hook 'formBuilder2.prepCpTemplate' %}

{% set selectedSubnavItem = "forms" %}
{% set bodyClass = 'formbuilder fb-edit-form' %}
{% set pageSlug = craft.request.lastSegment %}

{% if pageSlug == 'edit' %}
    {% set page = 'Edit Form' %}
{% else %}
    {% set page = 'New Form' %}
{% endif %}

{% block pageHeader %}
    {% include 'formbuilder2/_includes/_header' ignore missing with { title: page } %}
{% endblock %}

{% block saveButton %}

{% endblock %}

{% block main %}

    <input type="hidden" name="action" value="formBuilder2/form/saveForm">
    <input type="hidden" name="redirect" value="formbuilder2/forms">

    {% if form.id %}
        <input type="hidden" name="formId" value="{{ form.id }}">
        <input type="hidden" name="fieldLayoutId" value="{{ form.fieldLayoutId }}">
    {% endif %}

    {# <div class="btngroup submit first">
        <input type="submit" class="btn submit" value="{{ 'Save'|t }}">
        {% if form.id %}
            <div class="btn submit menubtn"></div>
            <div class="menu">
                <ul>
                    <li><a class="formsubmit" data-redirect="prodeal/forms/edit/{{ form.id  }}">{{ "Save and continue editing"|t }} <span class="shortcut">âŒ˜S</span></a></li>
                </ul>
            </div>
        {% endif %}
    </div> #}

    {% set errors = form.getErrors() %}
    {% set templates = craft.formBuilder2.getTemplates() %}
    {% set templateGroupOptions = [{label: 'Select Template', value: ''}] %}
    
    <div class="grid first" data-max-cols="3">

        <div class="item" data-position="left" data-colspan="2">
            {% include 'formbuilder2/forms/_includes/fields' ignore missing with { theme: 'moss' } %}
            {% include 'formbuilder2/forms/_includes/messages' ignore missing with { theme: 'moss' } %}
            {% include 'formbuilder2/forms/_includes/admin-notification' ignore missing with { theme: 'moss' } %}
            {% include 'formbuilder2/forms/_includes/submitter-notification' ignore missing with { theme: 'moss' } %}
        </div>

        <div class="editform-sidebar item" data-position="right">
            <section class="form-settings-tout cmp-tout theme-white">
                <header>
                    <span class="tout-title">{{ "Form Settings" |t }}</span>
                </header>
                <div class="body">
                    {% include 'formbuilder2/forms/_includes/options/basic-settings' ignore missing %}
                </div>
            </section>

            <section class="form-options-tout cmp-tout theme-white">
                <header>
                    <span class="tout-title">{{ "Form Options" |t }}</span>
                </header>
                <div class="body">
                    {% include 'formbuilder2/forms/_includes/options/submit-button' ignore missing %}
                    {% include 'formbuilder2/forms/_includes/options/redirect' ignore missing %}
                    {% include 'formbuilder2/forms/_includes/options/ajax' ignore missing %}
                    {% include 'formbuilder2/forms/_includes/options/file-uploads' ignore missing %}
                    {% include 'formbuilder2/forms/_includes/options/terms-conditions' ignore missing %}
                    {# {% include 'formbuilder2/forms/_includes/options/scripts' ignore missing %} #}
                    {# {% include 'formbuilder2/forms/_includes/options/custom-subject' ignore missing %} #}
                </div>
            </section>
            
            <section class="spam-protection-tout cmp-tout theme-white">
                <header>
                    <span class="tout-title">{{ "Spam Protection" |t }}</span>
                </header>
                <div class="body">
                    {% include 'formbuilder2/forms/_includes/spam/honeypot' ignore missing %}
                    {% include 'formbuilder2/forms/_includes/spam/timed' ignore missing %}
                </div>
            </section>

            <div class="pane meta save-form-meta last">
                <button type="submit" href="#" class="btns btn-info save-form">{{ "Save Form" |t }}</button>
            </div>

            {% if form.id %}
                <div class="pane meta delete-form-meta last">
                    <a href="#" class="btns btn-danger delete-form" data-id="{{ form.id }}">{{ "Delete Form" |t }}</a>
                </div>
            {% endif %}
        </div>

    </div>

{% endblock %}

{% includeJsResource "formbuilder2/js/forms.js" %}
{% includeJsResource "formbuilder2/js/form-options.js" %}
{% includeJsResource "formbuilder2/js/notification-settings.js" %}

{% includejs %}
    $('.section-collapsible').each(function(i,el){
        new FormBuilderSection(el);
    });

    $('.settings-item').each(function(i,el){
        new NotificationSettingsItem(el);
    });

    {% if not form.handle %}new Craft.HandleGenerator('#formName', '#formHandle');{% endif %}
{% endincludejs %}
{%- set label            = field.name is defined ? field.name : null %}
{%- set instructions     = field.instructions is defined ? field.instructions : null %}
{%- set name             = field.handle is defined ? field.handle : null %}
{%- set required         = field.required is defined and field.required ? true : false %}
{%- set options          = attribute(options.fields, name) is defined ? attribute(options.fields, name) : {} %}
{%- set type             = field.type|lower %}
{%- set id               = options.id is defined ? options.id : name %}
{%- set class            = options.class is defined ? options.class : name ~ '-field' %}
{%- set value            = element is not empty ? element.getFieldValue(name) : null %}
{%- set errors           = element is not empty ? element.getErrors(name) : null %}
{%- set errorClass       = options.errorClass is defined ? options.errorClass : 'errors' %}
{%- set input            = craft.formBuilder2.getInputHtml(field, value, field.settings, options) %}

{%- namespace 'fields' -%}
    <div
        {%- if id %} id="{{ id }}-field"{% endif %} class="field {{ type }}
        {%- if class %} {{ class }}{% endif -%}
        {%- if errors %} {{ errorClass }}{% endif -%}
        {%- if required %} required{% endif -%}
        ">
        {% if label or instructions -%}
            <div class="heading">
            {% if label -%}
                <label{% if name %} for="{{ name }}"{% endif %}>
                    {{- label|raw|t -}}
                </label>
            {%- endif -%}
            {% if instructions %}
                <p class="instructions">{{ instructions|raw|t }}</p>
            {%- endif %}
        </div>
        {% endif -%}

        <div class="input">
            {{ input }}
        </div>
        {% include "errors" with { errors: errors } %}

    </div>
{%- endnamespace -%}
